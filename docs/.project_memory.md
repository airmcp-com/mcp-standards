# MCP Standards - Project Memory & Key Learnings

**Last Updated**: 2025-10-30
**Project**: mcp-standards (Simple Personal Memory MCP)
**Branch**: claude/mcp-constitutional-dev-011CUaw87C8d1QGhvvJ1DwqN

---

## üéØ Critical Success Factors

### MCP Tool Auto-Discovery

**THE KEY INSIGHT**: Tool descriptions are the ONLY mechanism for automatic tool discovery in Claude Desktop. Quality of descriptions directly determines auto-trigger rates.

#### What Works (70-85% auto-trigger rate):

1. **Explicit Trigger Phrases**
   - List exact user phrases: "remember", "I prefer", "always use", "never use"
   - Include correction patterns: "instead of", "not X, use Y", "actually use X"
   - Examples: "Remember: use uv not pip", "I prefer conventional commits"

2. **Directive Language for Proactive Tools**
   - "**IMPORTANT: Use this BEFORE**" - Creates strong priority
   - "**Always use when**" - Defines auto-trigger scenarios
   - "**MUST USE BEFORE**" - Maximum strength directive

3. **Domain-Specific Context**
   - Don't say "package manager" - say "Python package managers (pip/uv/poetry/conda)"
   - Don't say "version control" - say "Git workflows (commit styles, branch naming, merge vs rebase)"
   - Specificity enables pattern matching

4. **Concrete Examples in Descriptions**
   - Include real user phrases: "use uv not pip"
   - Show query patterns: "python package manager", "git commit style"
   - Demonstrate parameter values: "category: python, git, docker, general"

#### What Doesn't Work:

- ‚ùå Generic descriptions: "Store a preference" (too vague)
- ‚ùå MCP Prompts for routing (must be manually invoked)
- ‚ùå MCP Resources for memory (must be manually added via @)
- ‚ùå Implicit behavior without trigger phrases
- ‚ùå Assuming Claude "understands" tool purpose from name alone

---

## üîß Technical Implementation

### Module Execution (CRITICAL)

**Problem**: Direct file execution causes `ImportError: attempted relative import with no known parent package`

**Solution**: Use Python module syntax
```bash
# ‚ùå WRONG (breaks imports)
python src/mcp_standards/server_simple.py

# ‚úÖ CORRECT (resolves imports)
python -m mcp_standards.server_simple
```

**Applied Everywhere**:
- Claude Desktop config: `args: ["run", "--directory", "/path", "python", "-m", "mcp_standards.server_simple"]`
- package.json scripts: `"start:simple": "uv run python -m mcp_standards.server_simple"`
- Documentation: All setup guides, README, validation checklist

### uv vs pip Preference

**User Preference**: Always use `uv` instead of `pip` for Python package management

**Implementation**:
- All documentation updated to show `uv` examples
- Package.json scripts use `uv run`
- Claude Desktop config uses `uv` as command

---

## üìä MCP Protocol Best Practices

### Tool Description Formula

```python
Tool(
    name="<action_verb>",
    description=(
        "<What it does> <domain specificity>. "
        "Use when <trigger conditions>. "
        "**Trigger phrases**: '<phrase1>', '<phrase2>', '<pattern>'. "
        "**Examples**: '<concrete example 1>', '<example 2>'. "
        "**Always use when**: <auto-trigger scenario 1>, <scenario 2>. "
        "**Categories/Domains**: <specific areas it covers>."
    ),
    inputSchema={
        "properties": {
            "param": {
                "description": "<what param is> (e.g., '<concrete example>')"
            }
        }
    }
)
```

### Research Sources

- **MCP Official Specification**: https://modelcontextprotocol.io/specification/2025-06-18/server/tools
- **GitHub MCP Server**: Engineering team's patterns for tool descriptions
- **Ragie.ai**: Context-aware tool selection research
- **Arsturn**: Effective tool descriptions article
- **AgentDB**: 10+ MCP tools reference implementation

**Quote from GitHub Team**:
> "How we name a tool, explain what it does, and spell out its parameters directly affects whether the model picks the right tool, in the right order, with the right arguments."

---

## üöÄ Current Tool Implementations

### remember Tool

**Purpose**: Store user preferences, corrections, workflow rules

**Trigger Phrases**: "remember", "I prefer", "always use", "never use", "instead of", "not X, use Y"

**Examples in Description**:
- "Remember: use uv not pip"
- "I prefer conventional commits"
- "Always run tests before committing"
- "Use Docker Compose v2 only"

**Categories**: python, git, docker, general

**Expected Auto-Trigger Rate**: 85-95% for explicit "Remember:" commands

### recall Tool

**Purpose**: Search stored preferences BEFORE making recommendations

**Key Directives**:
- "**IMPORTANT: Use this BEFORE making any tool/command recommendations**"
- "**Always use when**: suggesting a package manager, recommending git commands, proposing Docker setup"

**Query Examples**:
- "python package manager"
- "git commit style"
- "docker compose preference"

**Expected Auto-Trigger Rate**: 70-85% when Claude considers tool suggestions

---

## üß™ Testing Patterns

### Test Cases for Auto-Discovery

**Explicit Remember (should trigger 95%+)**:
- "Remember: use uv not pip"
- "I prefer conventional commits"
- "Always use Docker Compose v2"

**Implicit Recall (should trigger 70-85%)**:
- "What Python package manager should I use?" ‚Üí Should check recall first
- "How should I commit this?" ‚Üí Should check Git preferences
- "Install pytest" ‚Üí Should check Python tool preferences

**Correction Detection (60-75%)**:
- "Actually, use poetry instead of pip" ‚Üí Should trigger remember
- "No, use X instead" ‚Üí Should detect correction pattern

---

## üìÅ Project Structure Learnings

### File Organization (Per CLAUDE.md Rules)

**NEVER save to root**:
- ‚ùå `test_something.py` in root
- ‚ùå `notes.md` in root
- ‚ùå Working files in root

**ALWAYS use subdirectories**:
- ‚úÖ `/src` - Source code
- ‚úÖ `/tests` - Test files
- ‚úÖ `/docs` - Documentation
- ‚úÖ `/scripts` - Utility scripts
- ‚úÖ `/examples` - Example code

### Documentation Files

Created in this session:
- `docs/.project_memory.md` - This file (project learnings)
- Updated `CLAUDE.md` - MCP patterns and best practices
- Updated `README.md` - Correct uv/module syntax
- Updated `docs/QUICKSTART_SIMPLE.md` - Installation guide
- Updated `docs/VALIDATION_CHECKLIST.md` - Testing guide

---

## üîÑ Workflow Patterns

### Git Commit Style (Learned from Session)

**Pattern**: Conventional commits with detailed body

```
<type>: <short summary>

<detailed explanation of changes>
- Bullet point 1
- Bullet point 2

<rationale or context>

References:
- Source 1
- Source 2

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**Types Used**: `feat`, `fix`, `refactor`, `docs`, `test`

### Session Commits

1. `9ea7117` - fix: update all documentation to use uv with proper module syntax
2. `96daf36` - feat: enhance MCP tool descriptions for automatic discovery

---

## üéì Key Learnings

### 1. MCP Auto-Discovery is About Description Quality

The MCP protocol supports automatic tool discovery, but it's 100% dependent on how you write tool descriptions. Claude doesn't have magic understanding of tool purposes - you must be explicit.

**Impact**: Poor descriptions = manual tool invocation only. Rich descriptions = 70-85% auto-trigger rate.

### 2. Module Imports Require Module Execution

Python relative imports only work when running as a module with `-m`. Direct file execution breaks the package context.

**Impact**: All MCP servers using relative imports MUST use `python -m package.module` syntax.

### 3. Tool Names Matter Less Than Descriptions

Using generic names like `remember`/`recall` is fine IF descriptions are rich with context. Specificity comes from description content, not just names.

### 4. Proactive Tools Need Directive Language

For tools that should run BEFORE Claude takes action (like checking preferences before suggesting commands), use strong directive language:
- "IMPORTANT: Use this BEFORE"
- "MUST USE BEFORE"
- "Always check this before"

### 5. Examples Drive Understanding

Including concrete examples in descriptions dramatically improves auto-trigger rates:
- Show exact user phrases: "Remember: use uv not pip"
- Show query patterns: "python package manager preference"
- Show parameter values: "category: python, git, docker"

---

## üö´ What Didn't Work

### Attempted Solutions That Failed

1. **Generic Tool Descriptions**
   - Original: "Store a preference in personal memory"
   - Problem: Too vague, Claude didn't know when to use it
   - Solution: Added trigger phrases, examples, domains

2. **Assuming Natural Language Routes Automatically**
   - Thought: "Remember:" would automatically trigger remember tool
   - Reality: Needs explicit patterns in description
   - Fix: Added "**Trigger phrases**: 'remember', 'I prefer'..."

3. **Using MCP Prompts for Routing**
   - Idea: Define when tools should trigger via MCP prompts
   - Reality: MCP prompts must be manually invoked (not auto)
   - Learning: Only tool descriptions enable auto-discovery

---

## üìà Success Metrics

### Expected Outcomes After Tool Description Updates

| Scenario | Before | After (Target) |
|----------|--------|----------------|
| Explicit "Remember:" commands | 50% | 95% |
| Implicit recall before suggestions | 0% | 70-85% |
| Correction detection | 40% | 60-75% |
| Overall auto-discovery | 30% | 75%+ |

### Testing Required

- [ ] "Remember: use uv not pip" ‚Üí Auto-triggers remember tool
- [ ] "What Python package manager?" ‚Üí Auto-triggers recall
- [ ] "Install pytest" ‚Üí Checks recall before suggesting command
- [ ] "Actually, use poetry" ‚Üí Detects correction pattern

---

## üîÆ Future Improvements

### Potential Enhancements

1. **Add More Trigger Patterns**
   - Workflow declarations: "my workflow requires X"
   - Negative preferences: "never use X", "avoid Y"
   - Team conventions: "our team standard is X"

2. **Category-Specific Recall**
   - Before Python suggestions: Auto-query python category
   - Before Git commands: Auto-query git category
   - Before Docker operations: Auto-query docker category

3. **Confidence Scoring**
   - Track how often preferences are reinforced
   - Promote preferences after 2-3 confirmations
   - Detect conflicting preferences

4. **Cross-Project Memory**
   - Distinguish global vs project-local preferences
   - Share common patterns across projects
   - Keep project-specific overrides

---

## üõ†Ô∏è Maintenance Notes

### When to Update Tool Descriptions

Update descriptions when:
- Auto-trigger rates drop below 70%
- New user phrase patterns emerge
- Categories expand (add new domains)
- False positives occur (triggering when shouldn't)

### Testing New Descriptions

1. Update description in `src/mcp_standards/server_simple.py`
2. Restart Claude Desktop (MCP servers reload)
3. Test natural language patterns
4. Monitor Claude Desktop logs for tool invocations
5. Measure auto-trigger success rate
6. Iterate based on failures

### Documentation to Keep Updated

- `README.md` - User-facing examples
- `docs/QUICKSTART_SIMPLE.md` - Setup instructions
- `docs/VALIDATION_CHECKLIST.md` - Testing scenarios
- This file (`.project_memory.md`) - Learnings and patterns

---

## üìö References & Resources

### Official Documentation
- MCP Protocol Spec: https://modelcontextprotocol.io/specification/2025-06-18/server/tools
- Claude Desktop Config: `~/Library/Application Support/Claude/claude_desktop_config.json`
- Claude Desktop Logs: `~/Library/Logs/Claude/mcp*.log`

### Research Articles
- GitHub MCP Server engineering patterns
- Ragie.ai: Context-aware tool selection
- Arsturn: Effective tool descriptions
- MCP-Zero: Active tool discovery research (arXiv 2506.01056v3)

### Code References
- `src/mcp_standards/server_simple.py:95-155` - Tool definitions
- `src/mcp_standards/agentdb_client.py` - AgentDB integration
- `src/mcp_standards/hooks/auto_memory.py` - Correction detection
- `scripts/setup-agentdb.js` - Setup automation

---

## üí° Pro Tips

1. **Write descriptions for the LLM, not humans** - Be explicit, redundant, specific
2. **Test in Claude Desktop, not Claude Code** - MCP tools only available in Desktop
3. **Check logs for verification** - `tail -f ~/Library/Logs/Claude/mcp*.log`
4. **Restart Desktop after changes** - MCP servers reload on restart
5. **Use directive language** - "MUST", "ALWAYS", "BEFORE" create priority
6. **Include concrete examples** - Show, don't just tell
7. **List trigger phrases** - Exact words users might say
8. **Specify domains** - "Python package managers" not "package managers"

---

**Remember**: The quality of your tool descriptions determines whether users have a magical "it just works" experience or need to explicitly invoke tools. Invest time in descriptions - they're your only auto-discovery mechanism.
